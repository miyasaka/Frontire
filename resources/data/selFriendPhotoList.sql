SELECT
  A.MID AS MID
 ,A.ANO AS ANO
 ,A.TITLE AS TITLE
 ,TO_CHAR(A.ENTDATE,'yyyy年mm月dd日 hh24:mi') AS ENTDATE
 ,A.NICKNAME AS NICKNAME
 ,A.CNT AS COMMENTS
FROM
  (SELECT
     PA.MID
    ,PA.ANO
    ,PA.TITLE
    ,CASE WHEN PC.ENTDATE IS NULL THEN PA.ENTDATE ELSE PC.ENTDATE END AS ENTDATE
    ,PC.CNT
    ,M.NICKNAME
   FROM
     PHOTO_ALBUM PA
     LEFT JOIN (SELECT MID,ANO,COUNT(MID) AS CNT,MAX(ENTDATE) AS ENTDATE
                FROM PHOTO_COMMENT
                WHERE
                     DELFLG = '0'
                GROUP BY MID, ANO) PC ON PA.MID = PC.MID AND PA.ANO = PC.ANO
    ,MEMBERS M
   WHERE
        PA.PUBLEVEL != '4'
    AND PA.MID      IN /*listmid*/(1 ,2)
    AND PA.MID       = M.MID
    AND PA.DELFLG    = '0'
    AND M.STATUS     = '1') A
ORDER BY A.ENTDATE DESC