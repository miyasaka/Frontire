SELECT
 B.DIARYID,
 MAX(NULLIF(B.TITLE,'')) AS LTITLE,
CASE WHEN LENGTH(MAX(B.TITLE)) > 20 THEN SUBSTR(MAX(B.TITLE),0,21)||'・・・' ELSE MAX(B.TITLE) END AS TITLE,
 TO_CHAR(MIN(B.ENTDATE),'YYYYMMDD') AS YYYYMMDD,
 CASE WHEN
   TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(MIN(B.ENTDATE),'YYYYMMDD')
 THEN
   TO_CHAR(MIN(B.ENTDATE),'hh24:mi')
 ELSE
    TO_CHAR(MIN(B.ENTDATE),'MM月DD日')
 END  AS ENTDATE
FROM
 DIARY AS B
WHERE
 B.MID=/*mid*/ AND
 B.DELFLG = '0' AND
 B.PUB_DIARY IN /*pubdiary*/(1, 2)
GROUP BY B.DIARYID
ORDER BY MIN(B.ENTDATE) DESC


