SELECT
	A.MID,
	A.NICKNAME,
	A.ANO,
	A.L_TITLE,
	A.TITLE,
	A.PIC,
	A.UPDDATE2,
	A.COMMENTS,
	A.YYYYMMDD,
	A.ENTDATE,
	A.ENTDATE2
FROM
(
	-- グループメンバーのデータ取得
	SELECT
		PA.MID,
		M.NICKNAME,
		PA.ANO,
		PA.TITLE AS L_TITLE,
		PA.TITLE,
		P.PIC,
		CASE
			WHEN (TO_CHAR(PC.UPDDATE,'YYYYMMDD') IS NULL OR TO_CHAR(PC.UPDDATE,'YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD'))
			THEN (
					CASE
						WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD') THEN TO_CHAR(PA.UPDDATE,'HH24:MI')
						ELSE TO_CHAR(PA.UPDDATE,'YY/MM/DD')
					END
			)
			ELSE (
					CASE
						WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PC.UPDDATE,'YYYYMMDD') THEN TO_CHAR(PC.UPDDATE,'HH24:MI')
						ELSE TO_CHAR(PC.UPDDATE,'YY/MM/DD')
					END
			)
		END AS UPDDATE2,
		COALESCE(PC.COMMENTS,0) AS COMMENTS,
		CASE
			WHEN (TO_CHAR(PC.UPDDATE,'YYYYMMDD') IS NULL OR TO_CHAR(PC.UPDDATE,'YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD'))
			THEN PA.UPDDATE
			ELSE PC.UPDDATE
		END AS YYYYMMDD,
		PA.ENTDATE,
		CASE
			WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PA.ENTDATE,'YYYYMMDD')
			THEN TO_CHAR(PA.ENTDATE,'HH24:MI')
			ELSE TO_CHAR(PA.ENTDATE,'YY/MM/DD')
		END AS ENTDATE2
	FROM
		PHOTO_ALBUM PA
			LEFT JOIN (
			SELECT ANO,PIC,MID
			FROM PHOTO
			WHERE
				    COVERFLG  = '1'
				AND MID      IN /*listgmid*/(1 ,2)
				AND DELFLG    = '0'
			) P ON PA.ANO = P.ANO AND PA.MID = P.MID
				LEFT JOIN (
					SELECT MID,ANO,MAX(UPDDATE) AS UPDDATE,COUNT(MID) AS COMMENTS
					FROM PHOTO_COMMENT
					WHERE
						    MID    IN /*listgmid*/(1 ,2)
						AND DELFLG  = '0'
					GROUP BY MID,ANO
				) PC ON PA.ANO = PC.ANO AND PA.MID = PC.MID
		,MEMBERS M
	WHERE
		    PA.MID      IN /*listgmid*/(1 ,2)
		AND PA.MID       = M.MID
		-- 非公開のデータ以外を取得
		AND PA.PUBLEVEL != '9'
		AND PA.DELFLG    = '0'
		
UNION

	-- フォローメンバーのデータ取得
	SELECT
		PA.MID,
		M.NICKNAME,
		PA.ANO,
		PA.TITLE AS L_TITLE,
		PA.TITLE,
		P.PIC,
		CASE
			WHEN (TO_CHAR(PC.UPDDATE,'YYYYMMDD') IS NULL OR TO_CHAR(PC.UPDDATE,'YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD'))
			THEN (
					CASE
						WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD') THEN TO_CHAR(PA.UPDDATE,'HH24:MI')
						ELSE TO_CHAR(PA.UPDDATE,'YY/MM/DD')
					END
			)
			ELSE (
					CASE
						WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PC.UPDDATE,'YYYYMMDD') THEN TO_CHAR(PC.UPDDATE,'HH24:MI')
						ELSE TO_CHAR(PC.UPDDATE,'YY/MM/DD')
					END
			)
		END AS UPDDATE2,
		COALESCE(PC.COMMENTS,0) AS COMMENTS,
		CASE
			WHEN (TO_CHAR(PC.UPDDATE,'YYYYMMDD') IS NULL OR TO_CHAR(PC.UPDDATE,'YYYYMMDD') < TO_CHAR(PA.UPDDATE,'YYYYMMDD'))
			THEN PA.UPDDATE
			ELSE PC.UPDDATE
		END AS YYYYMMDD,
		PA.ENTDATE,
		CASE
			WHEN TO_CHAR(CURRENT_TIMESTAMP + '-1DAYS','YYYYMMDD') < TO_CHAR(PA.ENTDATE,'YYYYMMDD')
			THEN TO_CHAR(PA.ENTDATE,'HH24:MI')
			ELSE TO_CHAR(PA.ENTDATE,'YY/MM/DD')
		END AS ENTDATE2
	FROM
		PHOTO_ALBUM PA
			LEFT JOIN (
			SELECT ANO,PIC,MID
			FROM PHOTO
			WHERE
				    COVERFLG  = '1'
				AND MID      IN /*listfmid*/(1 ,2)
				AND DELFLG    = '0'
			) P ON PA.ANO = P.ANO AND PA.MID = P.MID
				LEFT JOIN (
					SELECT MID,ANO,MAX(UPDDATE) AS UPDDATE,COUNT(MID) AS COMMENTS
					FROM PHOTO_COMMENT
					WHERE
						    MID    IN /*listfmid*/(1 ,2)
						AND DELFLG  = '0'
					GROUP BY MID,ANO
				) PC ON PA.ANO = PC.ANO AND PA.MID = PC.MID
		,MEMBERS M
	WHERE
		    PA.MID      IN /*listfmid*/(1 ,2)
		AND PA.MID       = M.MID
		-- 全体に公開のデータのみを取得
		AND PA.PUBLEVEL  = '1'
		AND PA.DELFLG    = '0'
) AS A
/*IF sortcd == '01'*/
ORDER BY A.YYYYMMDD DESC
/*END*/
/*IF sortcd == '02'*/
ORDER BY A.ENTDATE DESC
/*END*/