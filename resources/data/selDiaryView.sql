SELECT
 A.DIARYID,
 A.COMNO,
 A.TITLE,
 A.COMMENT,
 A.PIC1,
 A.PIC2,
 A.PIC3,
 COALESCE(A.PICNOTE1,'') AS PICNOTE1,
 COALESCE(A.PICNOTE2,'') AS PICNOTE2,
 COALESCE(A.PICNOTE3,'') AS PICNOTE3,
 TO_CHAR(A.ENTDATE,'YYYYMMDDHH24MI') AS ENTDATE,
 B.NICKNAME,
 B.STATUS,
 B.MID,
 A.PUB_DIARY AS PUBDIARY,
 C.COMMENTS,
 D.COMMENTSOUTSIDE,
 A.PUB_LEVEL AS PUBLEVEL,
 A.APP_STATUS,
 B.MEMBERTYPE,
 A.GUEST_NAME,
 A.GUEST_EMAIL,
 A.GUEST_URL
FROM
 DIARY AS A,
 MEMBERS AS B,
(
 SELECT
  COUNT(*) AS COMMENTS
 FROM
  DIARY
 WHERE
  MID = /*mid*/
 AND DIARYID = /*diaryid*/
 AND DELFLG = '0'
 AND COMNO != '0'
) C,
(
 SELECT
  COUNT(*) AS COMMENTSOUTSIDE
 FROM
  DIARY
 WHERE
  MID = /*mid*/
 AND DIARYID = /*diaryid*/
 AND DELFLG = '0'
 AND COMNO != '0'
 AND PUB_LEVEL = '0'
 AND APP_STATUS = '4'
) D
WHERE
 A.MID = /*mid*/ AND
 A.DIARYID = /*diaryid*/ AND
 A.DELFLG = '0' AND
 A.ENTID = B.MID AND
 (A.PUB_DIARY IN /*pubdiary*/(1, 2) AND COMNO ='0' OR COMNO != '0')
 /*IF membertype == "2" || membertype == "1"*/
  AND
  A.PUB_LEVEL IN /*publevel*/(1, 2) AND
  A.APP_STATUS IN /*appstatus*/(1, 2)
 /*END*/
ORDER BY A.COMNO ASC